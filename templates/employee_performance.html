<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord RH Dynamique</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.18.1/plotly.min.js"></script>
            <link rel="stylesheet" href="{{ url_for('static', filename='css/EP.css') }}">

</head>
<body>
    <div class="header">
        <h1>üìä Tableau de Bord RH Dynamique</h1>
        <p>Analyse en temps r√©el des ressources humaines</p>
    </div>

    <div class="controls">
        <button id="refreshBtn" class="refresh-btn" onclick="refreshAllData()">
            üîÑ Actualiser les donn√©es
        </button>
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            Chargement des donn√©es...
        </div>
                                                                        <button class="btn" onclick="toggleDarkMode()" id="themeToggle">üåô Mode Sombre</button>
    </div>

    <!-- Navigation Cards -->
    <div class="navigation">
        <div class="nav-card active" onclick="showSection('overview')">
            <div class="nav-card-icon">üìà</div>
            <div class="nav-card-title">Vue d'Ensemble</div>
            <div class="nav-card-desc">M√©triques cl√©s et statistiques g√©n√©rales</div>
        </div>
        <div class="nav-card" onclick="showSection('demographics')">
            <div class="nav-card-icon">üë•</div>
            <div class="nav-card-title">Analyses D√©mographiques</div>
            <div class="nav-card-desc">√Çges, √©tat civil, enfants, pyramide des √¢ges</div>
        </div>
        <div class="nav-card" onclick="showSection('organization')">
            <div class="nav-card-icon">üè¢</div>
            <div class="nav-card-title">Structure Organisationnelle</div>
            <div class="nav-card-desc">Services, cat√©gories, anciennet√©</div>
        </div>
        <div class="nav-card" onclick="showSection('gender')">
            <div class="nav-card-icon">‚öñÔ∏è</div>
            <div class="nav-card-title">Analyses par Genre</div>
            <div class="nav-card-desc">Diversit√©, √©volution, r√©partition</div>
        </div>
        <div class="nav-card" onclick="showSection('temporal')">
            <div class="nav-card-icon">üìÖ</div>
            <div class="nav-card-title">Analyses Temporelles</div>
            <div class="nav-card-desc">Embauches, d√©parts, turnover</div>
        </div>
        <div class="nav-card" onclick="showSection('quality')">
            <div class="nav-card-icon">üîç</div>
            <div class="nav-card-title">Qualit√© des Donn√©es</div>
            <div class="nav-card-desc">Compl√©tude et int√©grit√©</div>
        </div>
    </div>

    <!-- Overview Section -->
    <div id="overview" class="dashboard-section active">
        <div class="section-header">
            <div class="section-title">üìà Vue d'Ensemble des Ressources Humaines</div>
            <div class="section-description">M√©triques cl√©s et indicateurs de performance RH</div>
        </div>
        
        <div class="overview-grid" id="overviewGrid">
            <!-- Metrics will be loaded dynamically -->
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-card-title">üìä R√©partition par Statut d'Employ√©</div>
                <div id="statusDistribution" class="custom-content">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-card-title">üèÜ Top 5 Services</div>
                <div id="topServices" class="custom-content">
                    <!-- Content loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Demographics Section -->
    <div id="demographics" class="dashboard-section">
        <div class="section-header">
            <div class="section-title">üë• Analyses D√©mographiques</div>
            <div class="section-description">Structure d'√¢ge, √©tat civil et situation familiale</div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-card-title">üë´ R√©partition de l'√âtat Civil</div>
                <div id="civilStatusChart" class="chart-content"></div>
            </div>
            <div class="chart-card">
                <div class="chart-card-title">üìä Pyramide des √Çges</div>
                <div id="agePyramidChart" class="chart-content"></div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-card-title">üë∂ Distribution des Enfants</div>
                <div id="childrenChart" class="chart-content"></div>
            </div>
            <div class="chart-card">
                <div class="chart-card-title">üìà Distribution des √Çges par Genre</div>
                <div id="ageByGenderChart" class="chart-content"></div>
            </div>
        </div>
    </div>

    <!-- Organization Section -->
    <div id="organization" class="dashboard-section">
        <div class="section-header">
            <div class="section-title">üè¢ Structure Organisationnelle</div>
            <div class="section-description">Services, cat√©gories professionnelles et anciennet√©</div>
        </div>

        <div class="charts-grid single-column">
            <div class="chart-card">
                <div class="chart-card-title">üè∑Ô∏è R√©partition par Service et Cat√©gorie</div>
                <div id="serviceCategoryChart" class="chart-content"></div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-card-title">‚è∞ Anciennet√© par Service</div>
                <div id="seniorityByServiceChart" class="chart-content"></div>
            </div>
            <div class="chart-card">
                <div class="chart-card-title">üë´ Anciennet√© par Genre</div>
                <div id="seniorityByGenderChart" class="chart-content"></div>
            </div>
        </div>
    </div>

    <!-- Gender Section -->
    <div id="gender" class="dashboard-section">
        <div class="section-header">
            <div class="section-title">‚öñÔ∏è Analyses par Genre</div>
            <div class="section-description">Diversit√© et √©quilibre homme-femme</div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-card-title">üë´ R√©partition par Genre</div>
                <div id="genderDistribution" class="custom-content"></div>
            </div>
            <div class="chart-card">
                <div class="chart-card-title">‚è∞ Analyse de l'Anciennet√©</div>
                <div id="seniorityAnalysis" class="custom-content"></div>
            </div>
        </div>

        <div class="charts-grid single-column">
            <div class="chart-card">
                <div class="chart-card-title">üìà √âvolution de la Diversit√© de Genre</div>
                <div id="genderEvolutionChart" class="chart-content"></div>
            </div>
        </div>
    </div>

    <!-- Temporal Section -->
    <div id="temporal" class="dashboard-section">
        <div class="section-header">
            <div class="section-title">üìÖ Analyses Temporelles</div>
            <div class="section-description">√âvolutions dans le temps, embauches et d√©parts</div>
        </div>

        <div class="charts-grid single-column">
            <div class="chart-card">
                <div class="chart-card-title">üìà √âvolution des Embauches</div>
                <div id="hiringTrendChart" class="chart-content"></div>
            </div>
        </div>

        <div class="charts-grid single-column">
            <div class="chart-card">
                <div class="chart-card-title">üîÑ Analyse du Turnover</div>
                <div id="turnoverChart" class="chart-content"></div>
            </div>
        </div>
    </div>

    <!-- Quality Section -->
    <div id="quality" class="dashboard-section">
        <div class="section-header">
            <div class="section-title">üîç Qualit√© des Donn√©es</div>
            <div class="section-description">Compl√©tude et int√©grit√© des donn√©es RH</div>
        </div>

        <div class="charts-grid single-column">
            <div class="chart-card">
                <div class="chart-card-title">üìã Compl√©tude des Donn√©es par Statut</div>
                <div id="dataCompletenessChart" class="chart-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Configuration globale
        const API_BASE = '';
        let isLoading = false;
        let currentSection = 'overview';

        // Utilitaires
        function showLoading() {
            isLoading = true;
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('refreshBtn').disabled = true;
        }

        function hideLoading() {
            isLoading = false;
            document.getElementById('loadingIndicator').style.display = 'none';
            document.getElementById('refreshBtn').disabled = false;
        }

        function showError(container, message) {
            document.getElementById(container).innerHTML = `
                <div class="error-message">
                    ‚ö†Ô∏è Erreur: ${message}
                </div>
            `;
        }
                async function initDashboard() {
            try {
                document.getElementById('connectionStatus').className = 'connection-status connection-online';
                document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle"></i> Connect√© √† Oracle';
                
                const backendData = await fetchDataFromOracle();
                dashboardData = transformData(backendData);
                
                updateSummaryStats();
                showTab('overview');
                createAllTables();
                generateInsights();
                
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
            } catch (error) {
                document.getElementById('loadingIndicator').innerHTML = 
                    '<div class="error"><i class="fas fa-exclamation-triangle"></i> Erreur de connexion: ' + error.message + '</div>';
                document.getElementById('connectionStatus').className = 'connection-status connection-offline';
                document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle"></i> D√©connect√©';
            }
        }


        // Navigation entre sections
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Remove active class from nav cards
            const navCards = document.querySelectorAll('.nav-card');
            navCards.forEach(card => card.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav card
            event.target.closest('.nav-card').classList.add('active');
            
            currentSection = sectionId;
            
            // Load section-specific data if not already loaded
            loadSectionData(sectionId);
        }

        function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'overview':
                    loadOverview();
                    loadStatusDistribution();
                    loadTopServices();
                    break;
                case 'demographics':
                    loadCivilStatusChart();
                    loadAgePyramid();
                    loadChildrenDistribution();
                    loadAgeDistributionByGender();
                    break;
                case 'organization':
                    loadServiceCategory();
                    loadSeniorityByService();
                    loadSeniorityByGender();
                    break;
                case 'gender':
                    loadGenderDistribution();
                    loadSeniorityAnalysis();
                    loadGenderEvolution();
                    break;
                case 'temporal':
                    loadHiringTrend();
                    loadTurnoverAnalysis();
                    break;
                case 'quality':
                    loadDataCompleteness();
                    break;
            }
        }

        // Chargement des donn√©es d'aper√ßu
        async function loadOverview() {
            try {
                const response = await fetch(`${API_BASE}/api/overview`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erreur de chargement');
                }

                const overviewGrid = document.getElementById('overviewGrid');
                overviewGrid.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${data.total_employees.toLocaleString()}</div>
                        <div class="metric-label">Total Employ√©s</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.current_employees.toLocaleString()}</div>
                        <div class="metric-label">Employ√©s Actuels</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.retention_rate}%</div>
                        <div class="metric-label">Taux de R√©tention</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.avg_age}</div>
                        <div class="metric-label">√Çge Moyen</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.avg_seniority}</div>
                        <div class="metric-label">Anciennet√© Moyenne</div>
                    </div>
                `;
            } catch (error) {
                showError('overviewGrid', error.message);
            }
        }

        async function loadStatusDistribution() {
            try {
                const response = await fetch(`${API_BASE}/api/overview`);
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error);

                const container = document.getElementById('statusDistribution');
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; padding: 20px;">';
                
                const colors = ['#2E86AB', '#A23B72', '#F18F01', '#C73E1D', '#592E83'];
                let colorIndex = 0;
                
                for (const [status, count] of Object.entries(data.status_distribution)) {
                    const percentage = ((count / data.total_employees) * 100).toFixed(1);
                    html += `
                        <div style="background: linear-gradient(135deg, ${colors[colorIndex]}, ${colors[colorIndex]}aa); 
                                    color: white; padding: 20px; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold;">${count}</div>
                            <div style="font-size: 1rem; margin: 5px 0;">${status}</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">${percentage}%</div>
                        </div>
                    `;
                    colorIndex = (colorIndex + 1) % colors.length;
                }
                
                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                showError('statusDistribution', error.message);
            }
        }

        async function loadTopServices() {
            try {
                const response = await fetch(`${API_BASE}/api/top_services`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Erreur de chargement');
                }

                const container = document.getElementById('topServices');
                let html = '<div style="padding: 20px;">';
                
                html += '<h4 style="color: #2E86AB; text-align: center; margin-bottom: 20px;">Top 5 Services par Nombre d\'Employ√©s</h4>';
                html += '<div style="display: flex; flex-direction: column; gap: 15px;">';
                
                const colors = ['#2E86AB', '#A23B72', '#F18F01', '#C73E1D', '#592E83'];
                
                data.services.forEach((service, index) => {
                    const color = colors[index % colors.length];
                    const barWidth = (service.percentage / Math.max(...data.services.map(s => s.percentage))) * 100;
                    
                    html += `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="min-width: 30px; text-align: center; font-weight: bold; color: ${color};">
                                ${index + 1}
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <span style="font-weight: 500; color: #333;">${service.service}</span>
                                    <span style="font-weight: bold; color: ${color};">${service.count} (${service.percentage}%)</span>
                                </div>
                                <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: ${color}; height: 100%; width: ${barWidth}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                html += `<div style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9rem;">
                           Total: ${data.total_employees} employ√©s actuels
                         </div>`;
                html += '</div>';
                
                container.innerHTML = html;
            } catch (error) {
                showError('topServices', error.message);
            }
        }

        // Toutes les autres fonctions de chargement des graphiques...
        async function loadCivilStatusChart() {
            try {
                const response = await fetch(`${API_BASE}/api/civil_status_chart`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('civilStatusChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('civilStatusChart', error.message);
            }
        }

        async function loadAgePyramid() {
            try {
                const response = await fetch(`${API_BASE}/api/age_pyramid`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('agePyramidChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('agePyramidChart', error.message);
            }
        }

        async function loadChildrenDistribution() {
            try {
                const response = await fetch(`${API_BASE}/api/children_distribution`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('childrenChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('childrenChart', error.message);
            }
        }

        async function loadAgeDistributionByGender() {
            try {
                const response = await fetch(`${API_BASE}/api/age_distribution_by_gender`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('ageByGenderChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('ageByGenderChart', error.message);
            }
        }

        async function loadServiceCategory() {
            try {
                const response = await fetch(`${API_BASE}/api/service_category`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('serviceCategoryChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('serviceCategoryChart', error.message);
            }
        }

        async function loadSeniorityByService() {
            try {
                const response = await fetch(`${API_BASE}/api/seniority_by_service`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('seniorityByServiceChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('seniorityByServiceChart', error.message);
            }
        }

        async function loadSeniorityByGender() {
            try {
                const response = await fetch(`${API_BASE}/api/seniority_by_gender`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('seniorityByGenderChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('seniorityByGenderChart', error.message);
            }
        }

        async function loadGenderDistribution() {
            try {
                const response = await fetch(`${API_BASE}/api/gender_distribution`);
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error);

                const container = document.getElementById('genderDistribution');
                let html = '<div style="text-align: center; padding: 20px;">';
                
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 20px 0;">';
                
                for (const [genre, count] of Object.entries(data.counts)) {
                    const percentage = data.percentages[genre];
                    const color = genre === 'Homme' ? '#2E86AB' : genre === 'Femme' ? '#A23B72' : '#95A5A6';
                    
                    html += `
                        <div style="background: linear-gradient(135deg, ${color}, ${color}aa); color: white; padding: 20px; border-radius: 15px;">
                            <div style="font-size: 2rem; font-weight: bold;">${count}</div>
                            <div style="font-size: 1rem; margin: 5px 0;">${genre}</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">${percentage}%</div>
                        </div>
                    `;
                }
                
                html += '</div>';
                html += `<div style="font-size: 1.1rem; color: #666; margin-top: 20px;">Total: ${data.total} employ√©s actuels</div>`;
                html += '</div>';
                
                container.innerHTML = html;
            } catch (error) {
                showError('genderDistribution', error.message);
            }
        }

        async function loadSeniorityAnalysis() {
            try {
                const response = await fetch(`${API_BASE}/api/seniority_analysis`);
                const data = await response.json();
                
                if (!response.ok) throw new Error(data.error);

                const container = document.getElementById('seniorityAnalysis');
                let html = '<div style="text-align: center; padding: 20px;">';
                
                html += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #F18F01, #ffa726); color: white; padding: 20px; border-radius: 15px;">
                            <div style="font-size: 2rem; font-weight: bold;">${data.avg_seniority} ans</div>
                            <div>Anciennet√© Moyenne</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #592E83, #8e44ad); color: white; padding: 20px; border-radius: 15px;">
                            <div style="font-size: 2rem; font-weight: bold;">${data.median_seniority} ans</div>
                            <div>Anciennet√© M√©diane</div>
                        </div>
                    </div>
                `;
                
                html += '<h4 style="color: #2E86AB; margin-bottom: 20px;">R√©partition par Tranche d\'Anciennet√©</h4>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">';
                
                const colors = ['#E8F4FD', '#B3D9F7', '#7FB8E5', '#4A90D3', '#1565C0'];
                let colorIndex = 0;
                
                for (const [category, count] of Object.entries(data.counts)) {
                    const percentage = data.percentages[category];
                    
                    html += `
                        <div style="background: ${colors[colorIndex]}; padding: 15px; border-radius: 10px; 
                                    border: 2px solid ${colors[Math.min(colorIndex + 1, colors.length - 1)]};">
                            <div style="font-size: 1.5rem; font-weight: bold; color: #1565C0;">${count}</div>
                            <div style="font-size: 0.9rem; color: #333; margin: 5px 0;">${category}</div>
                            <div style="font-size: 0.8rem; color: #666;">${percentage}%</div>
                        </div>
                    `;
                    colorIndex++;
                }
                
                html += '</div></div>';
                container.innerHTML = html;
            } catch (error) {
                showError('seniorityAnalysis', error.message);
            }
        }

        async function loadGenderEvolution() {
            try {
                const response = await fetch(`${API_BASE}/api/gender_evolution`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('genderEvolutionChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('genderEvolutionChart', error.message);
            }
        }

        async function loadHiringTrend() {
            try {
                const response = await fetch(`${API_BASE}/api/hiring_trend`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('hiringTrendChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('hiringTrendChart', error.message);
            }
        }

        async function loadTurnoverAnalysis() {
            try {
                const response = await fetch(`${API_BASE}/api/turnover_analysis`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('turnoverChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('turnoverChart', error.message);
            }
        }

        async function loadDataCompleteness() {
            try {
                const response = await fetch(`${API_BASE}/api/data_completeness`);
                const graphData = await response.json();
                
                if (!response.ok) throw new Error(graphData.error);

                const plotData = JSON.parse(graphData);
                Plotly.newPlot('dataCompletenessChart', plotData.data, plotData.layout, {
                    responsive: true,
                    displayModeBar: false
                });
            } catch (error) {
                showError('dataCompletenessChart', error.message);
            }
        }

        // Fonction pour rafra√Æchir toutes les donn√©es
        async function refreshAllData() {
            if (isLoading) return;
            
            showLoading();
            
            try {
                await fetch(`${API_BASE}/api/refresh_data`);
                loadSectionData(currentSection);
                
                const btn = document.getElementById('refreshBtn');
                btn.innerHTML = '‚úÖ Donn√©es actualis√©es!';
                setTimeout(() => {
                    btn.innerHTML = 'üîÑ Actualiser les donn√©es';
                }, 2000);
                
            } catch (error) {
                console.error('Erreur lors de l\'actualisation:', error);
                const btn = document.getElementById('refreshBtn');
                btn.innerHTML = '‚ùå Erreur d\'actualisation';
                setTimeout(() => {
                    btn.innerHTML = 'üîÑ Actualiser les donn√©es';
                }, 3000);
            } finally {
                hideLoading();
            }
        }
        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
        });

        // Chargement initial
        document.addEventListener('DOMContentLoaded', function() {
            loadSectionData('overview');
        });

        // Gestion du redimensionnement
        window.addEventListener('resize', function() {
            // Redimensionner les graphiques Plotly actifs
            const activeCharts = document.querySelectorAll('.dashboard-section.active .chart-content');
            activeCharts.forEach(chart => {
                if (chart.id && window.Plotly && chart._fullLayout) {
                    Plotly.Plots.resize(chart.id);
                }
            });
        });
        function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    const toggleBtn = document.getElementById('themeToggle');
    toggleBtn.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è Mode Clair' : 'üåô Mode Sombre';
    // Persist theme preference
    localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
}

// Load theme on page load
document.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('themeToggle').textContent = '‚òÄÔ∏è Mode Clair';
    }
});
    </script>
</body>
</html>
